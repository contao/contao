{% extends "@Contao/form_row.html.twig" %}
{% use "@Contao/component/_stylesheet.html.twig" %}

{% add "altcha" to stylesheets %}
    {% with {file: asset('css/altcha.min.css', 'contao-components/altcha') } %}{{ block('stylesheet_component') }}{% endwith %}
{% endadd %}

{% add "altcha" to body %}
    <script src="{{ asset('js/altcha.min.js', 'contao-components/altcha') }}" type="module"></script>
{% endadd %}

{% block label %}
  {% if this.label %}
    <label for="ctrl_{{ this.id }}"{% if this.class|default %} class="{{ this.class|default }}"{% endif %}>
      <span class="invisible">{{ this.mandatoryField }} </span>{{ this.label }}<span class="mandatory">*</span>
    </label>
  {% endif %}
{% endblock %}

{% block field %}
  <noscript><p class="warning">{{ 'ERR.altchaJavaScriptRequired'|trans }}</p></noscript>
  {% if hasErrors.invoke() %}
    <p class="error">{{ getErrorAsString.invoke() }}</p>
  {% endif %}

  {% if not canUseAltcha %}
    <p class="error">{{ 'ERR.altchaInsecureConnection'|trans }}</p>
  {% else %}
    <altcha-widget{{ altchaAttributes.>set('workerurl', asset('js/worker.js', 'contao-components/altcha')) }}></altcha-widget>
  {% endif %}
{% endblock %}
