{% extends '@Contao/form_row.html.twig' %}
{% use '@Contao/component/_stylesheet.html.twig' %}
{% trans_default_domain 'contao_default' %}

{% block label %}
    {% if this.label and not this.altchaFloating %}
        <label for="ctrl_{{ this.id }}"{% if this.class|default %} class="{{ this.class|default }}"{% endif %}>
            <span class="invisible">{{ this.mandatoryField }} </span>{{ this.label }}<span class="mandatory">*</span>
        </label>
    {% endif %}
{% endblock %}

{% block field %}
    <noscript><p class="warning">{{ 'ERR.altchaJavaScriptRequired'|trans }}</p></noscript>
    {% if hasErrors.invoke() %}
        <p class="error">{{ getErrorAsString.invoke() }}</p>
    {% endif %}

    {% if not this.canUseAltcha %}
        <p class="error">{{ 'ERR.altchaInsecureConnection'|trans }}</p>
    {% else %}
        {% add 'altcha' to stylesheets %}
            {% with {file: asset('css/altcha.min.css', 'contao-components/altcha')} %}{{ block('stylesheet_component') }}{% endwith %}
        {% endadd %}

        {% add 'altcha' to body %}
            <script src="{{ asset('js/altcha.min.js', 'contao-components/altcha') }}" type="module"></script>
        {% endadd %}

        <altcha-widget{{ attrs()
            .set('workerurl', asset('js/worker.js', 'contao-components/altcha'))
            .mergeWith(this.altchaAttributes)
        }}></altcha-widget>
    {% endif %}
{% endblock %}
