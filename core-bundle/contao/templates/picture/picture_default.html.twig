
{% if sources %}
  <picture>
    {% for source in sources %}
      {% set define_proportions = source.width|default(false) and source.height|default(false) %}
      {% set source_attributes = attrs()
        .set('srcset', source.srcset])
        .setIfExists('sizes', source.sizes]|default)
        .setIfExists('media', source.media]|default)
        .setIfExists('type', source.type]|default)
        .setIfExists('width', define_proportions ? source.width : null)
        .setIfExists('height', define_proportions ? source.height : null)
      %}
      <source{{ source_attributes }}>
    {% endfor %}
{% endif %}

{% set define_proportions = img.width|default(false) and img.height|default(false) %}
{% set img_attributes = attrs()
    .set('src', img.src)
    .set('srcset', img.srcset, img.srcset != img.src)
    .setIfExists('sizes', img.sizes|default)
    .setIfExists('width', define_proportions ? img.width : null)
    .setIfExists('height', define_proportions ? img.height : null)
    .set('alt', alt)
    .set('loading', img.loading|default, img.loading|default)
    .setIfExists('title', title|default)
    .addClass(class|default)
    .addClass(img.class|default)
    .mergeWith(attributes)
%}
<img{{ img_attributes }}>

{% if sources %}
    </picture>
{% endif %}
